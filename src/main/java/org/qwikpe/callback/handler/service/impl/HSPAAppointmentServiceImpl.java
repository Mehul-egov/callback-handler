package org.qwikpe.callback.handler.service.impl;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.qwikpe.callback.handler.service.HSPAAppointmentService;
import org.qwikpe.callback.handler.util.Constants;
import org.qwikpe.callback.handler.util.WebClientUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.autoconfigure.AutoConfigureOrder;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.web.reactive.function.client.WebClient;

import java.sql.Timestamp;
import java.util.HashMap;
import java.util.Map;

@Service
public class HSPAAppointmentServiceImpl implements HSPAAppointmentService {
    private static final Logger LOGGER = LoggerFactory.getLogger(HSPAAppointmentServiceImpl.class);

    @Autowired
    private WebClientUtil webClientUtil;

    @Override
    public void searchDoctor(JsonNode jsonNode) throws JsonProcessingException {
        try{
            ObjectMapper mapper = new ObjectMapper();

            Map<String, String> headers = new HashMap<>();
            String consumerUri = jsonNode.get("context").get("consumer_uri").textValue();
            String consumerId = jsonNode.get("context").get("consumer_id").textValue();
            Timestamp timestamp = new Timestamp(System.currentTimeMillis());

            String searchResponse = "{ \"context\": { \"domain\": \"nic2004:85111\", \"country\": \"IND\", \"city\": \"std:011\", \"action\": \"on_search\", \"timestamp\": \""+timestamp+"\", \"core_version\": \"0.7.1\", \"consumer_id\": \""+consumerId+"\", \"consumer_uri\": \""+consumerUri+"\", \"provider_id\": \"qwikpro.eua\", \"provider_uri\": \"https://hspasbx.abdm.gov.in/api/v1\", \"transaction_id\": \"e9a19230-f951-11ec-b135-53aea776f66b\", \"message_id\": \"e9a19230-f951-11ec-b135-53aea776f66b\" }, \"message\": { \"catalog\": { \"descriptor\": { \"name\": \"Ref HSPA\", \"images\": \"HSPA IMAGE\", \"short_desc\": \"Reference HSPA Test hospital\", \"long_desc\": \"Expert institution providing patient treatment with specialized health science and auxiliary healthcare staff and extraordinary medical equipments.\" }, \"providers\": [ { \"id\": \"1\", \"descriptor\": { \"name\": \"Test Hospital\", \"short_desc\": \"Expertise in every field with renowned staff.\", \"long_desc\": \"We are Test hospital. We have established a very profound name in the healthcare industry by providing expert services in every healthcare fields that we have.\" }, \"categories\": [ { \"id\": \"1\", \"parent_category_id\": \"101\", \"descriptor\": { \"name\": \"Cardiology\", \"code\": \"CARDIOLOGY\" } }, { \"id\": \"101\", \"descriptor\": { \"name\": \"Allopathy\", \"code\": \"ALLOPATHY\" } }, { \"id\": \"0\", \"parent_category_id\": \"101\", \"descriptor\": { \"name\": \"General Medicine, Pharmacy, Dental surgery\", \"code\": \"GENERAL MEDICINE, PHARMACY, DENTAL SURGERY\" } } ], \"fulfillments\": [ { \"id\": \"0\", \"type\": \"Online\", \"agent\": { \"id\": \"virat018@hpr.abdm\", \"name\": \"Virat Kohali\", \"gender\": \"M\", \"tags\": { \"@abdm/gov/in/experience\": \"10.0\", \"@abdm/gov/in/languages\": \"Hindi, English\", \"@abdm/gov/in/education\": \"MBBS, BDS\", \"@abdm/gov/in/hpr_id\": \"73-5232-1888-8686\" } }, \"start\": { \"time\": { \"timestamp\": \"2024-07-01T00:00:00\" } }, \"end\": { \"time\": { \"timestamp\": \"2023-07-10T00:00:00\" } } }, { \"id\": \"1\", \"type\": \"Online\", \"agent\": { \"id\": \"rohit045@hpr.ndhm\", \"name\": \"Rohit Sharma\", \"gender\": \"M\", \"tags\": { \"@abdm/gov/in/experience\": \"5.0\", \"@abdm/gov/in/languages\": \"Eng, Hin\", \"@abdm/gov/in/education\": \"MBBS\", \"@abdm/gov/in/hpr_id\": \"73-5232-1888-8686\" } }, \"start\": { \"time\": { \"timestamp\": \"2024-07-01T00:00:00\" } }, \"end\": { \"time\": { \"timestamp\": \"2023-07-15T00:00:00\" } } } ], \"items\": [ { \"id\": \"0\", \"descriptor\": { \"name\": \"Consultation\" }, \"price\": { \"currency\": \"INR\", \"value\": \"500.0\" }, \"category_id\": \"0\", \"fulfillment_id\": \"0\" }, { \"id\": \"1\", \"descriptor\": { \"name\": \"Consultation\" }, \"price\": { \"currency\": \"INR\", \"value\": \"300.0\" }, \"category_id\": \"1\", \"fulfillment_id\": \"1\" } ], \"location\": { \"id\": \"0\", \"descriptor\": { \"name\": \"Test Hospital\", \"short_desc\": \"Expertise in every field with renowned staff.\", \"long_desc\": \"We are Test hospital. We have established a very profound name in the healthcare industry by providing expert services in every healthcare fields that we have.\" }, \"city\": { \"name\": \"Delhi\", \"code\": \"011\" }, \"country\": { \"name\": \"INDIA\", \"code\": \"+91\" }, \"gps\": \"18.5246036,73.792927\", \"address\": \"3rd, 7th & 9th Floor, Tower-L, Jeevan Bharati Building, Connaught Place, New Delhi, Delhi 110001\" } } ] } } }";
            JsonNode responseJsonNode = mapper.readTree(searchResponse);

            JsonNode onSearchResponse = webClientUtil.postMethod(Constants.UHI_BASE_URL, Constants.UHI_ON_SEARCH, headers, responseJsonNode, JsonNode.class, 3);

            LOGGER.info("on_Search_Response(search) :: {}", onSearchResponse);

            System.out.println("Consumer Uri : "+consumerUri);
            System.out.println("Consumer Id : "+consumerId);

        } catch (Exception ex) {
            throw new RuntimeException(ex.getMessage());
        }
    }

    public void secondSearch(JsonNode jsonNode) {
        try {
            ObjectMapper mapper = new ObjectMapper();

            Map<String, String> headers = new HashMap<>();
            String consumerUri = jsonNode.get("context").get("consumer_uri").textValue();
            String consumerId = jsonNode.get("context").get("consumer_id").textValue();
            Timestamp timestamp = new Timestamp(System.currentTimeMillis());

            String searchResponse = "{\"context\":{\"domain\":\"nic2004:85111\",\"country\":\"IND\",\"city\":\"std:011\",\"action\":\"on_search\",\"timestamp\":\""+timestamp+"\",\"core_version\":\"0.7.1\",\"consumer_id\":\""+consumerId+"\",\"consumer_uri\":\""+consumerUri+"\",\"provider_id\":\"qwikpro.eua\",\"provider_uri\":\"https://abdm.qwikpe.in\",\"transaction_id\":\"e9a19230-f951-11ec-b135-53aea776f66b\",\"message_id\":\"dc0486e2-07a1-405e-840d-bffbce4beefc\"},\"message\":{\"catalog\":{\"descriptor\":{\"name\":\"Ref HSPA\",\"short_desc\":\"Reference HSPA Test hospital\",\"long_desc\":\"Expert institution providing patient treatment with specialized health science and auxiliary healthcare staff and extraordinary medical equipments.\"},\"providers\":[{\"id\":\"1\",\"descriptor\":{\"name\":\"Test Hospital\",\"short_desc\":\"Expertise in every field with renowned staff.\",\"long_desc\":\"We are Test hospital. We have established a very profound name in the healthcare industry by providing expert services in every healthcare fields that we have.\"},\"fulfillments\":[{\"id\":\"c8aa2d92-8140-4385-9676-31ef5204ab1f\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-06-28T11:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-06-28T11:15:00\"}}},{\"id\":\"f55ebf35-061a-42b5-9e10-79bcc1ddf1c6\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-06-28T11:30:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-06-28T11:45:00\"}}},{\"id\":\"9c48e536-1812-4d2a-a5c3-d25ce43c6fac\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-06-28T11:45:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-06-28T12:00:00\"}}},{\"id\":\"20d67b70-615f-4815-8b87-21dd66eb5798\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-06-28T12:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-06-28T12:15:00\"}}},{\"id\":\"a3b69676-8bd0-4779-b5bf-84e75081a889\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-06-28T12:15:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-06-28T12:30:00\"}}},{\"id\":\"0ef432d9-13f9-4a5b-bb6d-9ac343452643\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-06-28T12:30:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-06-28T12:45:00\"}}},{\"id\":\"2d359cf4-3d6c-496f-8de1-dd157c7ed5d3\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-06-28T12:45:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-06-28T13:00:00\"}}},{\"id\":\"8cfc1f68-96e0-4d95-a6bb-10a41db627a6\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-06-28T13:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-06-28T13:15:00\"}}},{\"id\":\"2c6d9861-8bd1-46f7-b61a-54174dc5ba5b\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-06-28T13:15:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-06-28T13:30:00\"}}},{\"id\":\"f7652f23-c3ed-452b-9edc-955a70072148\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-06-28T13:30:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-06-28T13:45:00\"}}},{\"id\":\"7aa4a9bc-61b9-4b5e-8904-01a41db54022\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-06-28T13:45:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-06-28T14:00:00\"}}},{\"id\":\"828ec4fc-ffb3-4e75-a9bf-456345859208\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-01T10:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-01T11:00:00\"}}},{\"id\":\"e88586aa-78e5-4a4d-a7d1-b2aeaf38a480\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-01T11:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-01T12:00:00\"}}},{\"id\":\"06b6c494-2a4e-43fc-bb52-c0b94ffa225e\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-01T13:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-01T14:00:00\"}}},{\"id\":\"3059d490-3c63-4526-8e27-bfecf21dd81e\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-01T14:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-01T15:00:00\"}}},{\"id\":\"311beb6b-9b9a-479f-bcc3-0fb901737b29\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-01T15:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-01T16:00:00\"}}},{\"id\":\"cdadb6f2-ef43-4c7e-9031-70b161410d52\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-01T16:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-01T17:00:00\"}}},{\"id\":\"7ea8fb43-9c56-4403-a55e-a2935e3eb9e1\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-01T17:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-01T18:00:00\"}}},{\"id\":\"a8998b2a-9b26-4073-b07f-75d5965c811e\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-01T18:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-01T19:00:00\"}}},{\"id\":\"d13ea4a9-c0a5-4afe-ac51-ceea4dd2dec1\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-01T19:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-01T20:00:00\"}}},{\"id\":\"ae6c3524-af32-4831-92da-bf5903f81a72\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-01T20:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-01T21:00:00\"}}},{\"id\":\"75f2d2e4-8ebd-4f38-89d2-ef45ef691d4c\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-01T21:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-01T22:00:00\"}}},{\"id\":\"43a20a41-e841-4b04-ad42-b68f29ed5e32\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T13:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T13:15:00\"}}},{\"id\":\"cef2f6ad-42ac-4ffd-b9f4-46f5cbbcc9d6\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T13:15:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T13:30:00\"}}},{\"id\":\"a13b95c1-b3c1-4f96-8dda-e5da4b677274\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T13:30:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T13:45:00\"}}},{\"id\":\"a3390c4d-ad22-4694-8d16-8051313cd9ca\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T13:45:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T14:00:00\"}}},{\"id\":\"910bd00c-53bc-419f-8a6e-e760e440ed7a\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T14:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T14:15:00\"}}},{\"id\":\"ed3d4ea4-df8d-4e0e-9a4e-7418c319d346\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T14:15:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T14:30:00\"}}},{\"id\":\"c02f152b-8492-4c7f-b392-e72526c71e59\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T14:30:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T14:45:00\"}}},{\"id\":\"32da8eb3-b10a-4811-8dd3-79f872d26730\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T14:45:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T15:00:00\"}}},{\"id\":\"2fdda11d-a8f4-4611-8d40-4a86b6c4ff2f\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T15:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T15:15:00\"}}},{\"id\":\"818a73dd-158a-403d-91b7-48a4d30fada7\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T15:15:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T15:30:00\"}}},{\"id\":\"05731752-1517-4f80-80bf-0f45c3ab3b85\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T15:30:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T15:45:00\"}}},{\"id\":\"7f014b9c-d653-48aa-9a61-520ade7a0cae\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T15:45:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T16:00:00\"}}},{\"id\":\"c7608653-b10e-4b23-a2a0-adf0a8f1bc98\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T16:00:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T16:15:00\"}}},{\"id\":\"9aa205a7-3fb2-497e-8788-ab20d289dc8e\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T16:15:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T16:30:00\"}}},{\"id\":\"7cebec2f-61a3-4206-a5d2-c164e73c6917\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T16:30:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T16:45:00\"}}},{\"id\":\"1774af73-79b3-4eed-a01e-06d598b0533e\",\"type\":\"Online\",\"agent\":{\"id\":\"godhani2002@hpr.abdm\",\"name\":\"Godhani Monark Kisorbhai\",\"gender\":\"M\",\"tags\":{\"@abdm/gov.in/education\":\"MBBS\",\"@abdm/gov.in/experience\":\"2.0\",\"@abdm/gov.in/hpr_id\":\"godhani2002@hpr.abdm\",\"@abdm/gov.in/languages\":\"Gujarati, English, Hindi\"}},\"start\":{\"time\":{\"timestamp\":\"2024-07-02T16:45:00\"}},\"end\":{\"time\":{\"timestamp\":\"2024-07-02T17:00:00\"}}}],\"items\":[{\"id\":\"0\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"c8aa2d92-8140-4385-9676-31ef5204ab1f\"},{\"id\":\"1\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"f55ebf35-061a-42b5-9e10-79bcc1ddf1c6\"},{\"id\":\"2\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"9c48e536-1812-4d2a-a5c3-d25ce43c6fac\"},{\"id\":\"3\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"20d67b70-615f-4815-8b87-21dd66eb5798\"},{\"id\":\"4\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"a3b69676-8bd0-4779-b5bf-84e75081a889\"},{\"id\":\"5\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"0ef432d9-13f9-4a5b-bb6d-9ac343452643\"},{\"id\":\"6\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"2d359cf4-3d6c-496f-8de1-dd157c7ed5d3\"},{\"id\":\"7\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"8cfc1f68-96e0-4d95-a6bb-10a41db627a6\"},{\"id\":\"8\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"2c6d9861-8bd1-46f7-b61a-54174dc5ba5b\"},{\"id\":\"9\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"f7652f23-c3ed-452b-9edc-955a70072148\"},{\"id\":\"10\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"7aa4a9bc-61b9-4b5e-8904-01a41db54022\"},{\"id\":\"11\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"828ec4fc-ffb3-4e75-a9bf-456345859208\"},{\"id\":\"12\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"e88586aa-78e5-4a4d-a7d1-b2aeaf38a480\"},{\"id\":\"13\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"06b6c494-2a4e-43fc-bb52-c0b94ffa225e\"},{\"id\":\"14\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"3059d490-3c63-4526-8e27-bfecf21dd81e\"},{\"id\":\"15\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"311beb6b-9b9a-479f-bcc3-0fb901737b29\"},{\"id\":\"16\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"cdadb6f2-ef43-4c7e-9031-70b161410d52\"},{\"id\":\"17\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"7ea8fb43-9c56-4403-a55e-a2935e3eb9e1\"},{\"id\":\"18\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"a8998b2a-9b26-4073-b07f-75d5965c811e\"},{\"id\":\"19\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"d13ea4a9-c0a5-4afe-ac51-ceea4dd2dec1\"},{\"id\":\"20\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"ae6c3524-af32-4831-92da-bf5903f81a72\"},{\"id\":\"21\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"75f2d2e4-8ebd-4f38-89d2-ef45ef691d4c\"},{\"id\":\"22\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"43a20a41-e841-4b04-ad42-b68f29ed5e32\"},{\"id\":\"23\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"cef2f6ad-42ac-4ffd-b9f4-46f5cbbcc9d6\"},{\"id\":\"24\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"a13b95c1-b3c1-4f96-8dda-e5da4b677274\"},{\"id\":\"25\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"a3390c4d-ad22-4694-8d16-8051313cd9ca\"},{\"id\":\"26\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"910bd00c-53bc-419f-8a6e-e760e440ed7a\"},{\"id\":\"27\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"ed3d4ea4-df8d-4e0e-9a4e-7418c319d346\"},{\"id\":\"28\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"c02f152b-8492-4c7f-b392-e72526c71e59\"},{\"id\":\"29\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"32da8eb3-b10a-4811-8dd3-79f872d26730\"},{\"id\":\"30\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"2fdda11d-a8f4-4611-8d40-4a86b6c4ff2f\"},{\"id\":\"31\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"818a73dd-158a-403d-91b7-48a4d30fada7\"},{\"id\":\"32\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"05731752-1517-4f80-80bf-0f45c3ab3b85\"},{\"id\":\"33\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"7f014b9c-d653-48aa-9a61-520ade7a0cae\"},{\"id\":\"34\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"c7608653-b10e-4b23-a2a0-adf0a8f1bc98\"},{\"id\":\"35\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"9aa205a7-3fb2-497e-8788-ab20d289dc8e\"},{\"id\":\"36\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"7cebec2f-61a3-4206-a5d2-c164e73c6917\"},{\"id\":\"37\",\"descriptor\":{\"name\":\"Consultation\",\"code\":\"CONSULTATION\"},\"price\":{\"currency\":\"INR\",\"value\":\"0.0\"},\"fulfillment_id\":\"1774af73-79b3-4eed-a01e-06d598b0533e\"}],\"location\":{\"id\":\"1\",\"descriptor\":{\"name\":\"Test Hospital\",\"short_desc\":\"Expertise in every field with renowned staff.\",\"long_desc\":\"We are Test hospital. We have established a very profound name in the healthcare industry by providing expert services in every healthcare fields that we have.\"},\"city\":{\"name\":\"Delhi\",\"code\":\"011\"},\"country\":{\"name\":\"INDIA\",\"code\":\"+91\"},\"gps\":\"18.5246036,73.792927\",\"address\":\"3rd, 7th & 9th Floor, Tower-L, Jeevan Bharati Building, Connaught Place, New Delhi, Delhi 110001\"}}]}}}";
            JsonNode responseJsonNode = mapper.readTree(searchResponse);

            JsonNode onSearchResponse = webClientUtil.postMethod(Constants.UHI_BASE_URL, Constants.UHI_ON_SEARCH, headers, responseJsonNode, JsonNode.class, 3);

            LOGGER.info("on_Search_Response(Second search) :: {}", onSearchResponse);

            System.out.println("Consumer Uri : "+consumerUri);
            System.out.println("Consumer Id : "+consumerId);

        } catch (Exception ex) {
            throw new RuntimeException(ex.getMessage());
        }
    }
}
